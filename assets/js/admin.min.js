!function(t){"use strict";const e={init(){this.initTabs(),this.initCustomQuestions(),this.initFormValidation(),this.initTooltips(),this.initDynamicToggles(),this.initCountrySelect(),this.initBulkActions(),this.initBlockedIps(),this.initLazyLoading()},initCountrySelect(){t(".country-select").select2({placeholder:cf7HoneypotAdmin.i18n.selectCountries,closeOnSelect:!1,width:"100%",language:{searching:()=>cf7HoneypotAdmin.i18n.searching,noResults:()=>cf7HoneypotAdmin.i18n.noResults},templateResult:function(e){return e.id?t("<span>"+e.text+"</span>"):e.text}})},initTabs(){const e=t(".nav-tab"),n=t(".tab-content");e.on("click",(function(i){i.preventDefault();const o=t(this).attr("href");e.removeClass("nav-tab-active"),t(this).addClass("nav-tab-active"),n.hide(),t(o).fadeIn(300),history.pushState({},"",o)})),window.location.hash&&t(`a[href="${window.location.hash}"]`).trigger("click")},initCustomQuestions(){const e=t("#custom-questions-container"),n=this.getQuestionTemplate();t("#add-question").on("click",(()=>{const i=t(n(e.children().length));e.append(i),i.hide().slideDown(300)})),e.on("click",".remove-question",(function(e){const n=t(this).closest(".question-row");n.slideUp(300,(()=>n.remove()))}))},getQuestionTemplate:()=>t=>`\n                <div class="question-row">\n                    <input type="text"\n                           name="cf7_honeypot_settings[custom_questions][${t}][question]"\n                           placeholder="${cf7HoneypotAdmin.i18n.question}"\n                           class="question-input">\n                    <input type="text"\n                           name="cf7_honeypot_settings[custom_questions][${t}][answer]"\n                           placeholder="${cf7HoneypotAdmin.i18n.answer}"\n                           class="answer-input">\n                    <button type="button" class="button remove-question">\n                        <span class="dashicons dashicons-trash"></span>\n                    </button>\n                </div>\n            `,initFormValidation(){const e=t(".settings-form");e.on("submit",(t=>{this.validateForm(e)||(t.preventDefault(),this.showValidationErrors())})),e.on("input","input, textarea",function(){const e=t(this);this.validateField(e)}.bind(this))},validateForm(e){let n=!0;return e.find("[required]").each(((e,i)=>{this.validateField(t(i))||(n=!1)})),e.find('input[type="email"]').each(((e,i)=>{i.value&&!this.isValidEmail(i.value)&&(n=!1,this.addError(t(i),cf7HoneypotAdmin.i18n.invalidEmail))})),n},validateField(t){const e=t.val().trim();return t.prop("required")&&!e?(this.addError(t,cf7HoneypotAdmin.i18n.requiredField),!1):(this.removeError(t),!0)},addError(t,e){t.next(".error-message").length||t.addClass("has-error").after(`<span class="error-message">${e}</span>`)},removeError(t){t.removeClass("has-error").next(".error-message").remove()},initTooltips(){t(".cf7-honeypot-tooltip").each((function(){const e=t(this),n=e.find(".tooltip-content");e.on("mouseenter focus",(()=>{n.css({opacity:1,visibility:"visible",transform:"translateX(-50%) translateY(-8px)"})})).on("mouseleave blur",(()=>{n.css({opacity:0,visibility:"hidden",transform:"translateX(-50%) translateY(0)"})}))}))},initDynamicToggles(){t("[data-toggle]").on("change",(function(){const e=t(this).data("toggle");t(e).slideToggle(300)})),t(".protection-level-select").on("change",(function(){const e=t(this).val();t(this).closest(".form-setting-row").find(".protection-options").removeClass("low medium high").addClass(e)}))},initBulkActions(){t("#doaction").on("click",(e=>{e.preventDefault();if("delete"!==t("#bulk-action-selector-bottom").val())return;const n=t('input[name="bulk-delete[]"]:checked').map((function(){return t(this).val()})).get();0!==n.length?confirm(cf7HoneypotAdmin.i18n.deleteSelected)&&this.deleteSelectedRecords(n):alert(cf7HoneypotAdmin.i18n.selectOneRecord)})),t("#cb-select-all-1").on("change",(function(){const e=t(this).prop("checked");t('input[name="bulk-delete[]"]').prop("checked",e)}))},updateBulkActionButton(){const e=t('input[name="bulk-delete[]"]:checked').length;t("#doaction").prop("disabled",0===e)},updateSelectAllCheckbox(){const e=t('input[name="bulk-delete[]"]').length,n=t('input[name="bulk-delete[]"]:checked').length;t("#cb-select-all-1").prop({checked:n===e,indeterminate:n>0&&n<e})},initBlockedIps(){t(".unblock-ip").on("click",(function(){const e=t(this).data("ip");confirm(cf7HoneypotAdmin.i18n.unblockIp.replace("%s",e))&&t.post(ajaxurl,{action:"cf7_honeypot_unblock_ip",ip:e,nonce:cf7HoneypotAdmin.unblockNonce},(function(n){n.success?t("tr[data-ip='"+e+"']").fadeOut(300,(function(){t(this).remove()})):alert(cf7HoneypotAdmin.i18n.error)}))}))},initLazyLoading(){const e=t("#cf7-honeypot-load-more");if(!e.length)return;let n=parseInt(e.data("current-page"),10);const i=parseInt(e.data("total-pages"),10);e.on("click",(function(o){o.preventDefault(),n>=i||t.post(ajaxurl,{action:"cf7_honeypot_load_stats",page:n+1,nonce:cf7HoneypotAdmin.loadStatsNonce},(function(o){o.success&&(t("#stats-table-body").append(o.data.html),n++,e.data("current-page",n),n>=i&&e.hide())}))}))},deleteSelectedRecords(e){t.ajax({url:ajaxurl,type:"POST",data:{action:"cf7_honeypot_delete_records",ids:e,nonce:cf7HoneypotAdmin.deleteNonce},beforeSend:()=>{t("#doaction").prop("disabled",!0).addClass("updating-message")},success:n=>{if(n.success){e.forEach((e=>{t(`input[value="${e}"]`).closest("tr").next(".details-row").remove(),t(`input[value="${e}"]`).closest("tr").remove()}));const i=t('<div class="notice notice-success is-dismissible"><p></p></div>').find("p").text(n.data.message).end();t(".cf7-honeypot-stats").prepend(i)}},complete:()=>{t("#doaction").prop("disabled",!1).removeClass("updating-message"),this.updateSelectAllCheckbox(),this.updateBulkActionButton()}})},isValidEmail:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),showValidationErrors(){const e=t(".has-error").first();e.length&&t("html, body").animate({scrollTop:e.offset().top-100},500)}};t(document).ready((()=>e.init()))}(jQuery);
