(n=>{let e={init(){this.initTabs(),this.initCustomQuestions(),this.initFormValidation(),this.initTooltips(),this.initDynamicToggles(),this.initCountrySelect(),this.initBulkActions(),this.initBlockedIps()},initCountrySelect(){n(".country-select").select2({placeholder:"Select countries to block...",closeOnSelect:!1,width:"100%",templateResult:function(e){return e.id?n("<span>"+e.text+"</span>"):e.text}})},initTabs(){let t=n(".nav-tab"),i=n(".tab-content");t.on("click",function(e){e.preventDefault();e=n(this).attr("href");t.removeClass("nav-tab-active"),n(this).addClass("nav-tab-active"),i.hide(),n(e).fadeIn(300),history.pushState({},"",e)}),window.location.hash&&n(`a[href="${window.location.hash}"]`).trigger("click")},initCustomQuestions(){let t=n("#custom-questions-container"),i=this.getQuestionTemplate();n("#add-question").on("click",()=>{var e=n(i(t.children().length));t.append(e),e.hide().slideDown(300)}),t.on("click",".remove-question",function(e){let t=n(this).closest(".question-row");t.slideUp(300,()=>t.remove())})},getQuestionTemplate(){return e=>`
                <div class="question-row">
                    <input type="text"
                           name="cf7_honeypot_settings[custom_questions][${e}][question]"
                           placeholder="Question"
                           class="question-input">
                    <input type="text"
                           name="cf7_honeypot_settings[custom_questions][${e}][answer]"
                           placeholder="Answer"
                           class="answer-input">
                    <button type="button" class="button remove-question">
                        <span class="dashicons dashicons-trash"></span>
                    </button>
                </div>
            `},initFormValidation(){let t=n(".settings-form");t.on("submit",e=>{this.validateForm(t)||(e.preventDefault(),this.showValidationErrors())}),t.on("input","input, textarea",function(){var e=n(this);this.validateField(e)}.bind(this))},validateForm(e){let i=!0;return e.find("[required]").each((e,t)=>{this.validateField(n(t))||(i=!1)}),e.find('input[type="email"]').each((e,t)=>{t.value&&!this.isValidEmail(t.value)&&(i=!1,this.addError(n(t),"Invalid email format"))}),i},validateField(e){var t=e.val().trim();return e.prop("required")&&!t?(this.addError(e,"This field is required"),!1):(this.removeError(e),!0)},addError(e,t){e.next(".error-message").length||e.addClass("has-error").after(`<span class="error-message">${t}</span>`)},removeError(e){e.removeClass("has-error").next(".error-message").remove()},initTooltips(){n(".cf7-honeypot-tooltip").each(function(){var e=n(this);let t=e.find(".tooltip-content");e.on("mouseenter focus",()=>{t.css({opacity:1,visibility:"visible",transform:"translateX(-50%) translateY(-8px)"})}).on("mouseleave blur",()=>{t.css({opacity:0,visibility:"hidden",transform:"translateX(-50%) translateY(0)"})})})},initDynamicToggles(){n("[data-toggle]").on("change",function(){var e=n(this).data("toggle");n(e).slideToggle(300)}),n(".protection-level-select").on("change",function(){var e=n(this).val();n(this).closest(".form-setting-row").find(".protection-options").removeClass("low medium high").addClass(e)})},initBulkActions(){n("#doaction").on("click",e=>{e.preventDefault(),"delete"===n("#bulk-action-selector-bottom").val()&&(0===(e=n('input[name="bulk-delete[]"]:checked').map(function(){return n(this).val()}).get()).length?alert("Please select at least one record to delete"):confirm("Are you sure you want to delete the selected records?")&&this.deleteSelectedRecords(e))}),n("#cb-select-all-1").on("change",function(){var e=n(this).prop("checked");n('input[name="bulk-delete[]"]').prop("checked",e)})},updateBulkActionButton(){var e=n('input[name="bulk-delete[]"]:checked').length;n("#doaction").prop("disabled",0===e)},updateSelectAllCheckbox(){var e=n('input[name="bulk-delete[]"]').length,t=n('input[name="bulk-delete[]"]:checked').length;n("#cb-select-all-1").prop({checked:t===e,indeterminate:0<t&&t<e})},initBlockedIps(){n(".unblock-ip").on("click",function(){let t=n(this).data("ip");confirm("Unblock "+t+"?")&&n.post(ajaxurl,{action:"cf7_honeypot_unblock_ip",ip:t,nonce:cf7HoneypotAdmin.unblockNonce},function(e){e.success?n("tr[data-ip='"+t+"']").fadeOut(300,function(){n(this).remove()}):alert("Error")})})},deleteSelectedRecords(t){n.ajax({url:ajaxurl,type:"POST",data:{action:"cf7_honeypot_delete_records",ids:t,nonce:cf7HoneypotAdmin.deleteNonce},beforeSend:()=>{n("#doaction").prop("disabled",!0).addClass("updating-message")},success:e=>{e.success&&(t.forEach(e=>{n(`input[value="${e}"]`).closest("tr").next(".details-row").remove(),n(`input[value="${e}"]`).closest("tr").remove()}),e=n('<div class="notice notice-success is-dismissible"><p></p></div>').find("p").text(e.data.message).end(),n(".cf7-honeypot-stats").prepend(e))},complete:()=>{n("#doaction").prop("disabled",!1).removeClass("updating-message"),this.updateSelectAllCheckbox(),this.updateBulkActionButton()}})},isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},showValidationErrors(){var e=n(".has-error").first();e.length&&n("html, body").animate({scrollTop:e.offset().top-100},500)}};n(document).ready(()=>e.init())})(jQuery);
