(o=>{let e={init(){this.initTabs(),this.initCustomQuestions(),this.initFormValidation(),this.initTooltips(),this.initDynamicToggles(),this.initCountrySelect(),this.initBulkActions()},initCountrySelect(){o(".country-select").select2({placeholder:"Select countries to block...",closeOnSelect:!1,width:"100%",templateResult:function(e){return e.id?o("<span>"+e.text+"</span>"):e.text}})},initTabs(){let t=o(".nav-tab"),i=o(".tab-content");t.on("click",function(e){e.preventDefault();e=o(this).attr("href");t.removeClass("nav-tab-active"),o(this).addClass("nav-tab-active"),i.hide(),o(e).fadeIn(300),history.pushState({},"",e)}),window.location.hash&&o(`a[href="${window.location.hash}"]`).trigger("click")},initCustomQuestions(){let t=o("#custom-questions-container"),i=this.getQuestionTemplate();o("#add-question").on("click",()=>{var e=o(i(t.children().length));t.append(e),e.hide().slideDown(300)}),t.on("click",".remove-question",function(e){let t=o(this).closest(".question-row");t.slideUp(300,()=>t.remove())})},getQuestionTemplate(){return e=>`
                <div class="question-row">
                    <input type="text"
                           name="cf7_honeypot_settings[custom_questions][${e}][question]"
                           placeholder="Question"
                           class="question-input">
                    <input type="text"
                           name="cf7_honeypot_settings[custom_questions][${e}][answer]"
                           placeholder="Answer"
                           class="answer-input">
                    <button type="button" class="button remove-question">
                        <span class="dashicons dashicons-trash"></span>
                    </button>
                </div>
            `},initFormValidation(){let t=o(".settings-form");t.on("submit",e=>{this.validateForm(t)||(e.preventDefault(),this.showValidationErrors())}),t.on("input","input, textarea",function(){var e=o(this);this.validateField(e)}.bind(this))},validateForm(e){let i=!0;return e.find("[required]").each((e,t)=>{this.validateField(o(t))||(i=!1)}),e.find('input[type="email"]').each((e,t)=>{t.value&&!this.isValidEmail(t.value)&&(i=!1,this.addError(o(t),"Invalid email format"))}),i},validateField(e){var t=e.val().trim();return e.prop("required")&&!t?(this.addError(e,"This field is required"),!1):(this.removeError(e),!0)},addError(e,t){e.next(".error-message").length||e.addClass("has-error").after(`<span class="error-message">${t}</span>`)},removeError(e){e.removeClass("has-error").next(".error-message").remove()},initTooltips(){o(".cf7-honeypot-tooltip").each(function(){var e=o(this);let t=e.find(".tooltip-content");e.on("mouseenter focus",()=>{t.css({opacity:1,visibility:"visible",transform:"translateX(-50%) translateY(-8px)"})}).on("mouseleave blur",()=>{t.css({opacity:0,visibility:"hidden",transform:"translateX(-50%) translateY(0)"})})})},initDynamicToggles(){o("[data-toggle]").on("change",function(){var e=o(this).data("toggle");o(e).slideToggle(300)}),o(".protection-level-select").on("change",function(){var e=o(this).val();o(this).closest(".form-setting-row").find(".protection-options").removeClass("low medium high").addClass(e)})},initBulkActions(){o("#doaction").on("click",e=>{e.preventDefault(),"delete"===o("#bulk-action-selector-bottom").val()&&(0===(e=o('input[name="bulk-delete[]"]:checked').map(function(){return o(this).val()}).get()).length?alert("Please select at least one record to delete"):confirm("Are you sure you want to delete the selected records?")&&this.deleteSelectedRecords(e))}),o("#cb-select-all-1").on("change",function(){var e=o(this).prop("checked");o('input[name="bulk-delete[]"]').prop("checked",e)})},deleteSelectedRecords(t){o.ajax({url:ajaxurl,type:"POST",data:{action:"cf7_honeypot_delete_records",ids:t,nonce:cf7HoneypotAdmin.deleteNonce},beforeSend:()=>{o("#doaction").prop("disabled",!0)},success:e=>{e.success?(t.forEach(e=>{o(`tr[data-record-id="${e}"]`).remove()}),location.reload()):alert("Error deleting records")},error:()=>{alert("Error deleting records")},complete:()=>{o("#doaction").prop("disabled",!1)}})},deleteSelectedRecords(t){o.ajax({url:ajaxurl,type:"POST",data:{action:"cf7_honeypot_delete_records",ids:t,nonce:cf7HoneypotAdmin.deleteNonce},beforeSend:()=>{o("#doaction").prop("disabled",!0).addClass("updating-message")},success:e=>{e.success&&(t.forEach(e=>{o(`input[value="${e}"]`).closest("tr").next(".details-row").remove(),o(`input[value="${e}"]`).closest("tr").remove()}),e=o('<div class="notice notice-success is-dismissible"><p></p></div>').find("p").text(e.data.message).end(),o(".cf7-honeypot-stats").prepend(e))},complete:()=>{o("#doaction").prop("disabled",!1).removeClass("updating-message"),this.updateSelectAllCheckbox(),this.updateBulkActionButton()}})},updateBulkActionButton(){var e=o('input[name="bulk-delete[]"]:checked').length;o("#doaction").prop("disabled",0===e)},updateSelectAllCheckbox(){var e=o('input[name="bulk-delete[]"]').length,t=o('input[name="bulk-delete[]"]:checked').length;o("#cb-select-all-1").prop({checked:t===e,indeterminate:0<t&&t<e})},isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},showValidationErrors(){var e=o(".has-error").first();e.length&&o("html, body").animate({scrollTop:e.offset().top-100},500)}};o(document).ready(()=>e.init())})(jQuery);
